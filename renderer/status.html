<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self'">
  <title>Scale Desktop App - Status</title>
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
  <div class="status-container">
    <div class="status-header">
      <h1>Scale Desktop App</h1>
      <div class="status-badge running" id="service-badge">
        <span class="dot"></span>
        <span id="badge-text">Activo</span>
      </div>
    </div>

    <!-- Station info -->
    <div class="info-card">
      <h3>Informacion</h3>
      <table class="summary-table">
        <tr>
          <th>Servidor</th>
          <td id="info-server">-</td>
        </tr>
        <tr>
          <th>Estacion</th>
          <td id="info-station">-</td>
        </tr>
      </table>
    </div>

    <!-- Scale readings -->
    <div id="scales-container"></div>

    <!-- Scale management -->
    <div class="info-card" id="scales-management">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
        <h3 style="margin-bottom:0;">Basculas de esta estacion</h3>
        <button class="btn btn-primary btn-sm" id="btn-show-add-form">+ Agregar bascula</button>
      </div>

      <!-- Scales list -->
      <div id="scales-list"></div>

      <!-- Add scale form (hidden by default) -->
      <div id="add-scale-form" style="display:none;margin-top:16px;padding-top:16px;border-top:1px solid var(--border);">
        <h4 style="font-size:14px;font-weight:600;margin-bottom:12px;">Nueva bascula</h4>

        <div class="form-row">
          <div class="form-group">
            <label for="add-port">Puerto serial</label>
            <select id="add-port"></select>
          </div>
          <div class="form-group">
            <label for="add-profile">Perfil de bascula</label>
            <select id="add-profile"></select>
          </div>
        </div>

        <!-- Custom config fields -->
        <div id="add-custom-fields" style="display:none;">
          <div class="form-row">
            <div class="form-group">
              <label for="add-baud">Baud Rate</label>
              <select id="add-baud">
                <option value="2400">2400</option>
                <option value="4800">4800</option>
                <option value="9600" selected>9600</option>
                <option value="19200">19200</option>
                <option value="38400">38400</option>
                <option value="57600">57600</option>
                <option value="115200">115200</option>
              </select>
            </div>
            <div class="form-group">
              <label for="add-databits">Data Bits</label>
              <select id="add-databits">
                <option value="7">7</option>
                <option value="8" selected>8</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="add-parity">Paridad</label>
              <select id="add-parity">
                <option value="none" selected>None</option>
                <option value="even">Even</option>
                <option value="odd">Odd</option>
              </select>
            </div>
            <div class="form-group">
              <label for="add-stopbits">Stop Bits</label>
              <select id="add-stopbits">
                <option value="1" selected>1</option>
                <option value="2">2</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="add-poll">Comando Poll (vacio = transmision continua)</label>
            <input type="text" id="add-poll" placeholder="W\r\n" value="W\r\n">
          </div>
        </div>

        <div class="form-group">
          <label for="add-scale-id">Scale ID</label>
          <input type="text" id="add-scale-id" placeholder="BASCULA_01">
        </div>

        <div id="add-test-result" class="alert" style="margin-top:8px;"></div>

        <div style="display:flex;gap:8px;margin-top:8px;">
          <button class="btn btn-outline btn-sm" id="btn-test-add">Probar lectura</button>
          <button class="btn btn-success btn-sm" id="btn-confirm-add">Agregar bascula</button>
          <button class="btn btn-sm" id="btn-cancel-add" style="background:var(--border);color:var(--text);">Cancelar</button>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="status-actions">
      <button class="btn btn-outline" id="btn-reconfigure">Reconfigurar</button>
      <button class="btn btn-danger" id="btn-stop">Detener servicio</button>
      <button class="btn btn-success" id="btn-restart" style="display:none;">Reiniciar servicio</button>
    </div>
  </div>

  <script src="assets/js/status.js"></script>
</body>
</html>
